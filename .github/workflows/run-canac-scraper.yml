      - name: Publish to econoplus (reset to origin/main, copy, commit, rebase, push)
        shell: powershell
        env:
          SCRAPER_PATH: ${{ inputs.scraper_path }}
          ECONOPLUS_PATH: ${{ inputs.econoplus_path }}
          OUT_DIR: ${{ inputs.out_dir }}
          PUBLISH_SUBDIR: ${{ inputs.publish_subdir }}
          COMMIT_MESSAGE: ${{ inputs.commit_message }}
        run: |
          $ErrorActionPreference = "Stop"

          # 1) Aller dans econoplus et repartir proprement du remote
          Set-Location $env:ECONOPLUS_PATH
          git fetch origin
          git checkout main
          git reset --hard origin/main

          # 2) Copier les fichiers depuis le dossier final du scraper
          $outFull = Join-Path $env:SCRAPER_PATH $env:OUT_DIR
          if (-not (Test-Path $outFull)) { throw "Output folder not found: $outFull" }

          $target = Join-Path $env:ECONOPLUS_PATH ("public\" + $env:PUBLISH_SUBDIR)
          if (-not (Test-Path $target)) { New-Item -ItemType Directory -Path $target | Out-Null }

          Write-Host "Cleaning target: $target"
          Get-ChildItem -Path $target -Force -ErrorAction SilentlyContinue | Remove-Item -Force -Recurse -ErrorAction SilentlyContinue

          Write-Host "Copying from $outFull to $target"
          Copy-Item -Path (Join-Path $outFull "*") -Destination $target -Recurse -Force

          # 3) Commit si changements
          git add .
          $hasChanges = (git status --porcelain)
          if (-not $hasChanges) {
            Write-Host "No changes to commit"
            exit 0
          }

          git commit -m "$env:COMMIT_MESSAGE"

          # 4) Sécurité: si quelqu’un a push entre-temps, rebase puis push
          git pull --rebase origin main
          git push origin main
